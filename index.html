<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weatherly â€“ Search</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="center">
  <div class="card">
    <h1>Weatherly</h1>
    <p>Enter a city to see the forecast</p>

    <div class="search-box">
      <input
        id="cityInput"
        type="text"
        placeholder="Start typing a cityâ€¦"
        autocomplete="off"
      >
      <button id="searchBtn">ğŸ”</button>
      <ul id="suggestions"></ul>
    </div>
  </div>

  <script>
    const key = '637e619566e6dd275f2ada8670356e02'; // OpenWeatherMap key
    const input = document.getElementById('cityInput');
    const suggestions = document.getElementById('suggestions');
    const searchBtn = document.getElementById('searchBtn');

    /* ---------- debounce ---------- */
    function debounce(fn, delay = 300) {
      let t; return (...a) => { clearTimeout(t); t = setTimeout(() => fn(...a), delay); };
    }

    /* ---------- fetch cities ---------- */
    async function fetchCities(q) {
      if (!q) { suggestions.innerHTML = ''; suggestions.style.display = 'none'; return; }
      const res = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${q}&limit=5&appid=${key}`);
      const data = await res.json();
      renderSuggestions(data);
    }

    /* ---------- render dropdown ---------- */
    function renderSuggestions(list) {
      suggestions.innerHTML = '';
      if (!list.length) { suggestions.style.display = 'none'; return; }
      list.forEach(c => {
        const li = document.createElement('li');
        li.textContent = `${c.name}, ${c.country}`;
        li.addEventListener('click', () => selectCity(c.name));
        suggestions.appendChild(li);
      });
      suggestions.style.display = 'block';
    }

    /* ---------- city selected ---------- */
    function selectCity(city) {
      input.value = city;
      suggestions.innerHTML = '';
      suggestions.style.display = 'none';
      goToWeather(city);
    }

    /* ---------- navigation ---------- */
    function goToWeather(city) {
      if (!city.trim()) return;
      location.href = `weather.html?city=${encodeURIComponent(city)}`;
    }

    /* ---------- events ---------- */
    input.addEventListener('input', debounce(e => fetchCities(e.target.value.trim())));
    searchBtn.addEventListener('click', () => goToWeather(input.value.trim()));
    input.addEventListener('keypress', e => { if (e.key === 'Enter') goToWeather(input.value.trim()); });

    /* ---------- hide on outside click ---------- */
    document.addEventListener('click', e => {
      if (!e.target.closest('.search-box')) {
        suggestions.style.display = 'none';
      }
    });
  </script>
</body>
</html>
